var game={data:null,RN:4,CN:4,score:0,state:1,GAMEOVER:0,RUNNING:1,CELLSIZE:100,OFFSET:16,top:0,init:function(){for(var t=0,i=[];t<this.RN;t++)for(var a=0;a<this.CN;a++)i.push(""+t+a);gridPanel.innerHTML='<div id="g'+i.join('" class="grid"></div><div id="g')+'" class="grid"></div>',gridPanel.innerHTML+='<div id="c'+i.join('" class="cell"></div><div id="c')+'" class="cell"></div>';var s=this.CELLSIZE*this.CN+this.OFFSET*(this.CN+1);gridPanel.style.width=s+"px";var o=this.CELLSIZE*this.RN+this.OFFSET*(this.RN+1);gridPanel.style.height=o+"px"},start:function(){""!=document.cookie.trim()&&(this.top=parseInt(document.cookie.slice(4))),this.init(),this.state=this.RUNNING,this.score=0,this.data=[];for(var t=0;t<this.RN;t++){this.data[t]=[];for(var i=0;i<this.CN;i++)this.data[t][i]=0}this.randomNum(),this.randomNum(),this.updateView();var a=this;document.onkeydown=function(t){switch(t.keyCode){case 37:a.moveLeft();break;case 38:a.moveUp();break;case 39:a.moveRight();break;case 40:a.moveDown()}}},moveUpInCol:function(t){for(var i=0;i<this.RN-1;i++){var a=this.getDownInCol(i,t);if(a==-1)break;0==this.data[i][t]?(this.data[i][t]=this.data[a][t],this.data[a][t]=0,i--):this.data[i][t]==this.data[a][t]&&(this.score+=this.data[i][t]*=2,this.data[a][t]=0)}},getDownInCol:function(t,i){for(var a=t+1;a<this.RN;a++)if(0!=this.data[a][i])return a;return-1},moveDownInCol:function(t){for(var i=this.RN-1;i>0;i--){var a=this.getUpInCol(i,t);if(a==-1)break;0==this.data[i][t]?(this.data[i][t]=this.data[a][t],this.data[a][t]=0,i++):this.data[i][t]==this.data[a][t]&&(this.score+=this.data[i][t]*=2,this.data[a][t]=0)}},getUpInCol:function(t,i){for(var a=t-1;a>=0;a--)if(0!=this.data[a][i])return a;return-1},moveRightInRow:function(t){for(var i=this.CN-1;i>0;i--){var a=this.getPrevInRow(t,i);if(a==-1)break;0==this.data[t][i]?(this.data[t][i]=this.data[t][a],this.data[t][a]=0,i++):this.data[t][i]==this.data[t][a]&&(this.score+=this.data[t][i]*=2,this.data[t][a]=0)}},getPrevInRow:function(t,i){for(var a=i-1;a>=0;a--)if(0!=this.data[t][a])return a;return-1},randomNum:function(){for(;;){var t=parseInt(Math.random()*this.RN),i=parseInt(Math.random()*this.CN);if(0==this.data[t][i]){this.data[t][i]=Math.random()<.5?2:4;break}}},updateView:function(){for(var t=0;t<this.RN;t++)for(var i=0;i<this.CN;i++){var a=document.getElementById("c"+t+i);0==this.data[t][i]?(a.innerHTML="",a.className="cell"):(a.innerHTML=this.data[t][i],a.className="cell n"+this.data[t][i])}score.innerHTML=this.score,top1.innerHTML=this.top,finalScore.innerHTML=this.score,gameOver.style.display=this.state==this.GAMEOVER?"block":"none"},isGameOver:function(){for(var t=0;t<this.RN;t++)for(var i=0;i<this.CN;i++){if(0==this.data[t][i])return!1;if(i<this.CN-1&&this.data[t][i]==this.data[t][i+1])return!1;if(t<this.RN-1&&this.data[t][i]==this.data[t+1][i])return!1}return!0},move:function(t){var i=String(this.data);if(t(),i!=String(this.data)){if(this.randomNum(),this.isGameOver()&&(this.state=this.GAMEOVER,this.score>this.top)){var a=new Date("2020/01/01");document.cookie="top="+this.score+";expires="+a.toGMTString()}this.updateView()}},moveLeft:function(){var t=this;this.move(function(){for(var i=0;i<t.RN;i++)t.moveLeftInRow(i)})},moveRight:function(){var t=this;this.move(function(){for(var i=0;i<t.RN;i++)t.moveRightInRow(i)})},moveUp:function(){var t=this;this.move(function(){for(var i=0;i<t.CN;i++)t.moveUpInCol(i)})},moveDown:function(){var t=this;this.move(function(){for(var i=0;i<t.CN;i++)t.moveDownInCol(i)})},moveLeftInRow:function(t){for(var i=0;i<this.CN-1;i++){var a=this.getNextInRow(t,i);if(a==-1)break;0==this.data[t][i]?(this.data[t][i]=this.data[t][a],this.data[t][a]=0,i--):this.data[t][i]==this.data[t][a]&&(this.score+=this.data[t][i]*=2,this.data[t][a]=0)}},getNextInRow:function(t,i){for(var a=i+1;a<this.CN;a++)if(0!=this.data[t][a])return a;return-1}};window.onload=function(){game.start()};